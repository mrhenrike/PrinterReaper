%% PrinterReaper v2.4.2 - Architecture Visual (from ARCHITECTURE_VISUAL.txt)
%% Generates: diagrams/png/architecture_ascii_visual.png
flowchart TB

  %% User Interface Layer
  subgraph UIL["USER INTERFACE LAYER"]
  U["ğŸ‘¤ USER\nCommand: ls /etc/passwd\nMode: auto\nOptions: -d -s -q -i -o"]
  RSLT["ğŸ“„ RESULT\n/etc/passwd downloaded\nâœ… Successfully"]
  end

  %% Application Entry Point
  subgraph EP["APPLICATION ENTRY POINT"]
    MAIN["ğŸšª main.py (Entry Point)\nâ€¢ argparse: Parse CLI\nâ€¢ get_os(): Detect OS\nâ€¢ capabilities(): Detect language\nâ€¢ shell_map[mode]: Select module"]
  end

  %% Language Translation Layer
  subgraph LTL["LANGUAGE TRANSLATION LAYER"]
    PJL["ğŸ§­ PJL MODULE (pjl.py)\n54 Commands\nTranslates: ls â†’ @PJL FSDIRLIST...\nUses: codebook.py, const.PJL_VOL"]
    PS["ğŸ–‹ï¸ POSTSCRIPT MODULE (ps.py)\n40 Commands\nTranslates: ls â†’ filenameforall\nUses: operators.py, payloads/"]
    PCL["ğŸ“¦ PCL MODULE (pcl.py)\n15 Commands\nTranslates: ls â†’ List macros (virtual)\nUses: Macro tracking, const.ESC"]
  end

  %% Base Printer Class
  subgraph BPC["BASE PRINTER CLASS (printer.py)"]
    CORE["âš™ï¸ CORE FUNCTIONALITY (1,304 lines)\nâ€¢ do_open/close: Connection\nâ€¢ do_upload/download: File transfer\nâ€¢ do_cd/pwd/chvol: Navigation\nâ€¢ cmd_with_retry: Retry (3x)\nâ€¢ setup_signal_handlers: Ctrl+C\nâ€¢ onecmd: Timeout wrapper\nâ€¢ fuzz/mirror: Advanced ops"]
  end

  %% Discovery / Capabilities / Fuzzer
  subgraph DCF["DISCOVERY / CAPABILITIES / FUZZER"]
    DISC["ğŸ” DISCOVERY (discovery.py)\nSNMP Scan\n17 OIDs\nMulti-OS"]
    CAP["ğŸ§© CAPABILITIES (capabilities.py)\nIPP / HTTP / SNMP"]
    FZZ["ğŸ§ª FUZZER (fuzzer.py)\n254 paths\n31 names\nTraversal"]
  end

  %% Utility Engines Layer
  subgraph UEL["UTILITY ENGINES LAYER"]
    HLP["ğŸ§° HELPER UTILITIES (helper.py - 705 lines)\noutput() conv() file() conn() log()\nColors, Filesize, Read/Write, Socket, Timeout, Debug"]
    CBK["ğŸ“š CODEBOOK (codebook.py)\n378 Codes\nget_errors()"]
    OPS["ğŸ§® OPERATORS (operators.py)\n371 Operators\n16 Categories"]
    PAY["ğŸ“¦ PAYLOADS (payloads/)\n5 Templates\nload_payload()"]
    FZ2["ğŸ§ª FUZZER (fuzzer.py)\n381 Vectors\n4 Methods"]
  end

  %% Network Protocol Layer
  subgraph NPL["NETWORK PROTOCOL LAYER"]
    ROUTE["ğŸ•¹ï¸ Protocol Selection & Routing"]
    RAW["ğŸ”Œ RAW :9100"]
    LPD["ğŸ“® LPD :515"]
    IPP["ğŸŒ IPP :631"]
    SMB["ğŸ§· SMB :445"]
  end

  %% TCP/IP and Target
  TCP["ğŸŒ TCP/IP STACK (socket)"]
  PRN["ğŸ–¨ï¸ TARGET PRINTER\nPJL/PS/PCL Interpreters\nFilesystem (0:,1:,/etc,/webServer)\nNVRAM, Job Queue, Network Stack, Control Panel"]

  %% Flows
  U -->|ğŸ‘† Click| MAIN
  MAIN --> PJL
  MAIN --> PS
  MAIN --> PCL
  PJL --> CORE
  PS --> CORE
  PCL --> CORE
  CORE --> DISC
  CORE --> CAP
  CORE --> FZZ
  CORE --> HLP
  CORE --> CBK
  CORE --> FZ2
  PS --> OPS
  PS --> PAY
  CORE -->|â¡ï¸ Send| ROUTE
  ROUTE --> RAW
  ROUTE --> LPD
  ROUTE --> IPP
  ROUTE --> SMB
  RAW -->|â¡ï¸| TCP -->|â¡ï¸| PRN
  LPD --> TCP
  IPP --> TCP
  SMB --> TCP
  PRN -->|â¬…ï¸ Receive| RSLT

